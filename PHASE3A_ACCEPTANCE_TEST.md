# Phase 3A åŠŸèƒ½éªŒæ”¶æµ‹è¯•

## âœ… éªŒæ”¶æ ‡å‡†æ£€æŸ¥æ¸…å•

### 1. âœ… é¦–æ¬¡è¿›å…¥ â†’ æ˜¾ç¤ºé¢˜ç›®ï¼Œå¯ä½œç­”

**å®ç°éªŒè¯**:
- âœ… é¡µé¢åŠ è½½æ—¶è°ƒç”¨ `GET /api/progress/resume`
- âœ… æ˜¾ç¤ºé—®é¢˜æ–‡æœ¬å’Œé€‰é¡¹
- âœ… é€‰é¡¹å¯ç‚¹å‡»é€‰æ‹©
- âœ… æäº¤æŒ‰é’®å¯ç”¨ï¼ˆå½“é€‰æ‹©äº†ç­”æ¡ˆæ—¶ï¼‰

**æµ‹è¯•æ­¥éª¤**:
1. è®¿é—® `/questions`ï¼ˆå·²è®¤è¯ï¼‰
2. åº”è¯¥çœ‹åˆ°é—®é¢˜æ–‡æœ¬
3. åº”è¯¥çœ‹åˆ°æ‰€æœ‰é€‰é¡¹ï¼ˆA, B, C, D...ï¼‰
4. ç‚¹å‡»é€‰é¡¹åº”è¯¥å¯ä»¥é€‰ä¸­/å–æ¶ˆ
5. é€‰æ‹©ç­”æ¡ˆåï¼Œæäº¤æŒ‰é’®åº”è¯¥å¯ç”¨

**ä»£ç ä½ç½®**: `app/questions/page.tsx` - `loadQuestion()` å’Œæ¸²æŸ“é€»è¾‘

---

### 2. âœ… æäº¤ç­”æ¡ˆ â†’ æ˜¾ç¤º Correct / Incorrect

**å®ç°éªŒè¯**:
- âœ… è°ƒç”¨ `POST /api/progress` æäº¤ç­”æ¡ˆ
- âœ… åç«¯éªŒè¯ç­”æ¡ˆå¹¶è¿”å›çŠ¶æ€
- âœ… å‰ç«¯æ˜¾ç¤ºåç«¯è¿”å›çš„çŠ¶æ€ï¼ˆä¸çŒœæµ‹ï¼‰
- âœ… æ˜¾ç¤º "Correct!" æˆ– "Incorrect" æ¶ˆæ¯
- âœ… å¦‚æœé”™è¯¯ï¼Œæ˜¾ç¤ºé”™è¯¯æ¬¡æ•°

**æµ‹è¯•æ­¥éª¤**:
1. é€‰æ‹©æ­£ç¡®ç­”æ¡ˆå¹¶æäº¤
2. åº”è¯¥æ˜¾ç¤ºç»¿è‰² "Correct!" çŠ¶æ€
3. åˆ·æ–°é¡µé¢ï¼Œé€‰æ‹©é”™è¯¯ç­”æ¡ˆå¹¶æäº¤
4. åº”è¯¥æ˜¾ç¤ºçº¢è‰² "Incorrect" çŠ¶æ€
5. å¦‚æœé‡å¤é”™è¯¯ï¼Œåº”è¯¥æ˜¾ç¤ºé”™è¯¯æ¬¡æ•°

**ä»£ç ä½ç½®**: 
- `app/questions/page.tsx` - `handleSubmit()`
- `app/api/progress/route.ts` - åç«¯éªŒè¯é€»è¾‘

---

### 3. âœ… åˆ·æ–°é¡µé¢ â†’ çŠ¶æ€ä¸å˜

**å®ç°éªŒè¯**:
- âœ… æ¯æ¬¡é¡µé¢åŠ è½½éƒ½è°ƒç”¨ `GET /api/progress/resume`
- âœ… ä»åç«¯è·å–æœ€æ–°çŠ¶æ€ï¼ˆåŒ…æ‹¬å·²æäº¤çš„ç­”æ¡ˆï¼‰
- âœ… å¦‚æœå·²æäº¤ï¼Œæ¢å¤æ˜¾ç¤ºæäº¤çŠ¶æ€
- âœ… ä¸ä¾èµ– localStorage æˆ– sessionStorage
- âœ… ä¸ä¾èµ– useState æ¢å¤æŒä¹…åŒ–çŠ¶æ€

**æµ‹è¯•æ­¥éª¤**:
1. æäº¤ä¸€ä¸ªç­”æ¡ˆï¼ˆæ­£ç¡®æˆ–é”™è¯¯ï¼‰
2. åˆ·æ–°é¡µé¢ï¼ˆF5 æˆ– Cmd+Rï¼‰
3. åº”è¯¥çœ‹åˆ°ç›¸åŒçš„çŠ¶æ€ï¼ˆå·²æäº¤ï¼Œåªè¯»ï¼‰
4. åº”è¯¥çœ‹åˆ°ä¹‹å‰é€‰æ‹©çš„ç­”æ¡ˆ
5. åº”è¯¥çœ‹åˆ°æ­£ç¡®/é”™è¯¯çŠ¶æ€

**ä»£ç ä½ç½®**: 
- `app/questions/page.tsx` - `loadQuestion()` åœ¨ `useEffect` ä¸­è°ƒç”¨
- `app/api/progress/resume/route.ts` - è¿”å›æœ€æ–°çŠ¶æ€

**å…³é”®ä»£ç **:
```typescript
// æ¯æ¬¡é¡µé¢åŠ è½½éƒ½ä»åç«¯è·å–
useEffect(() => {
  loadQuestion() // ä»åç«¯è·å–æœ€æ–°çŠ¶æ€
}, [])

// æ¢å¤å·²æäº¤çš„ç­”æ¡ˆ
if (data.progress?.selected_answer) {
  setSelectedAnswers(data.progress.selected_answer) // ä»åç«¯æ¢å¤
}
```

---

### 4. âœ… æ¢æµè§ˆå™¨ / è®¾å¤‡ â†’ çŠ¶æ€ä¸€è‡´

**å®ç°éªŒè¯**:
- âœ… æ‰€æœ‰çŠ¶æ€å­˜å‚¨åœ¨æ•°æ®åº“ï¼ˆUserProgress, WrongBookï¼‰
- âœ… Session é€šè¿‡ HTTP-only cookie è·¨è®¾å¤‡å·¥ä½œ
- âœ… æ¯æ¬¡åŠ è½½éƒ½ä»åç«¯è·å–æœ€æ–°çŠ¶æ€
- âœ… ä¸ä¾èµ–æœ¬åœ°å­˜å‚¨

**æµ‹è¯•æ­¥éª¤**:
1. åœ¨è®¾å¤‡ A ä¸Šç™»å½•å¹¶æäº¤ç­”æ¡ˆ
2. åœ¨è®¾å¤‡ B ä¸Šä½¿ç”¨ç›¸åŒé‚®ç®±ç™»å½•
3. è®¿é—® `/questions`
4. åº”è¯¥çœ‹åˆ°ç›¸åŒçš„çŠ¶æ€ï¼ˆå·²æäº¤ï¼Œåªè¯»ï¼‰
5. åº”è¯¥çœ‹åˆ°ç›¸åŒçš„ç­”æ¡ˆå’Œæ­£ç¡®/é”™è¯¯çŠ¶æ€

**ä»£ç ä½ç½®**:
- `app/api/progress/resume/route.ts` - ä»æ•°æ®åº“è¯»å–çŠ¶æ€
- `app/api/auth/verify/route.ts` - è®¾ç½®è·¨è®¾å¤‡çš„ session cookie
- `middleware.ts` - éªŒè¯ session

---

### 5. âœ… é‡å¤ç­”é”™ â†’ wrong_count ç´¯åŠ 

**å®ç°éªŒè¯**:
- âœ… åç«¯ä½¿ç”¨ `wrong_count = existingWrong.wrong_count + 1`
- âœ… ä½¿ç”¨æ•°æ®åº“äº‹åŠ¡ç¡®ä¿åŸå­æ€§
- âœ… åªå¢ä¸å‡ï¼ˆä¸å›æ»šï¼‰
- âœ… å‰ç«¯æ˜¾ç¤ºé”™è¯¯æ¬¡æ•°

**æµ‹è¯•æ­¥éª¤**:
1. é€‰æ‹©ä¸€ä¸ªé—®é¢˜ï¼Œæäº¤é”™è¯¯ç­”æ¡ˆ
2. æ£€æŸ¥æ˜¾ç¤º "Incorrect" å’Œ "Wrong 1 times"
3. åˆ·æ–°é¡µé¢ï¼Œå†æ¬¡æäº¤é”™è¯¯ç­”æ¡ˆï¼ˆéœ€è¦å…è®¸é‡æ–°æäº¤ï¼Œä½† Phase 3A ä¸å…è®¸ï¼‰
4. æˆ–è€…ï¼šé€šè¿‡ API ç›´æ¥æµ‹è¯•é‡å¤æäº¤é”™è¯¯ç­”æ¡ˆ
5. éªŒè¯ wrong_count é€’å¢

**ä»£ç ä½ç½®**:
- `app/api/progress/route.ts` - `wrong_count: existingWrong.wrong_count + 1`
- `app/questions/page.tsx` - æ˜¾ç¤º `wrong_count`

**æ³¨æ„**: Phase 3A ä¸­ï¼Œæäº¤åä¸å…è®¸é‡æ–°æäº¤ã€‚è¦æµ‹è¯•é‡å¤ç­”é”™ï¼Œéœ€è¦ï¼š
- é€šè¿‡ API ç›´æ¥è°ƒç”¨ï¼Œæˆ–
- åœ¨ Phase 3B ä¸­å®ç°é‡æ–°ç­”é¢˜åŠŸèƒ½

---

### 6. âœ… UI ä¸ä¾èµ– localStorage / useState æ¢å¤çŠ¶æ€

**å®ç°éªŒè¯**:
- âœ… æ²¡æœ‰ä½¿ç”¨ `localStorage` æˆ– `sessionStorage`
- âœ… `useState` ä»…ç”¨äº UI ä¸´æ—¶çŠ¶æ€ï¼ˆloading, submittingï¼‰
- âœ… æŒä¹…åŒ–çŠ¶æ€ï¼ˆprogress, selected_answerï¼‰å®Œå…¨ä»åç«¯è·å–
- âœ… æ¯æ¬¡é¡µé¢åŠ è½½éƒ½é‡æ–°ä»åç«¯è·å–

**ä»£ç æ£€æŸ¥**:
```typescript
// âœ… æ­£ç¡®ï¼šä»åç«¯è·å–çŠ¶æ€
useEffect(() => {
  loadQuestion() // ä»åç«¯è·å–
}, [])

// âœ… æ­£ç¡®ï¼šuseState ä»…ç”¨äº UI çŠ¶æ€
const [loading, setLoading] = useState(true) // UI çŠ¶æ€
const [submitting, setSubmitting] = useState(false) // UI çŠ¶æ€

// âœ… æ­£ç¡®ï¼šæŒä¹…åŒ–çŠ¶æ€ä»åç«¯æ¢å¤
if (data.progress?.selected_answer) {
  setSelectedAnswers(data.progress.selected_answer) // ä»åç«¯
}

// âŒ é”™è¯¯ï¼šä¸åº”è¯¥è¿™æ ·åšï¼ˆä»£ç ä¸­æ²¡æœ‰ï¼‰
// localStorage.setItem('progress', ...) // ä¸å­˜åœ¨
// const saved = localStorage.getItem('progress') // ä¸å­˜åœ¨
```

**éªŒè¯æ–¹æ³•**:
- âœ… æœç´¢ä»£ç ï¼Œç¡®è®¤æ²¡æœ‰ localStorage/sessionStorage
- âœ… ç¡®è®¤æ‰€æœ‰æŒä¹…åŒ–çŠ¶æ€éƒ½ä»åç«¯ API è·å–
- âœ… ç¡®è®¤åˆ·æ–°åçŠ¶æ€ä»åç«¯æ¢å¤

---

## ğŸ§ª å®Œæ•´æµ‹è¯•æµç¨‹

### æµ‹è¯•åœºæ™¯ 1: é¦–æ¬¡è¿›å…¥

1. **å‡†å¤‡**: æ–°ç”¨æˆ·æˆ–æ¸…é™¤è¿›åº¦
2. **æ“ä½œ**: è®¿é—® `/questions`
3. **é¢„æœŸ**: 
   - âœ… æ˜¾ç¤ºé—®é¢˜
   - âœ… é€‰é¡¹å¯ç‚¹å‡»
   - âœ… æäº¤æŒ‰é’®ç¦ç”¨ï¼ˆæœªé€‰æ‹©ç­”æ¡ˆï¼‰

### æµ‹è¯•åœºæ™¯ 2: æäº¤æ­£ç¡®ç­”æ¡ˆ

1. **æ“ä½œ**: é€‰æ‹©æ­£ç¡®ç­”æ¡ˆï¼Œç‚¹å‡»æäº¤
2. **é¢„æœŸ**:
   - âœ… æ˜¾ç¤ºç»¿è‰² "Correct!" çŠ¶æ€
   - âœ… é€‰é¡¹å˜ä¸ºåªè¯»
   - âœ… æ­£ç¡®ç­”æ¡ˆé«˜äº®æ˜¾ç¤º

### æµ‹è¯•åœºæ™¯ 3: æäº¤é”™è¯¯ç­”æ¡ˆ

1. **æ“ä½œ**: é€‰æ‹©é”™è¯¯ç­”æ¡ˆï¼Œç‚¹å‡»æäº¤
2. **é¢„æœŸ**:
   - âœ… æ˜¾ç¤ºçº¢è‰² "Incorrect" çŠ¶æ€
   - âœ… é€‰é¡¹å˜ä¸ºåªè¯»
   - âœ… æ­£ç¡®ç­”æ¡ˆé«˜äº®ï¼ˆç»¿è‰²ï¼‰
   - âœ… é”™è¯¯é€‰æ‹©é«˜äº®ï¼ˆçº¢è‰²ï¼‰
   - âœ… æ˜¾ç¤º "Wrong 1 times"

### æµ‹è¯•åœºæ™¯ 4: åˆ·æ–°é¡µé¢

1. **æ“ä½œ**: æäº¤ç­”æ¡ˆåï¼Œåˆ·æ–°é¡µé¢ï¼ˆF5ï¼‰
2. **é¢„æœŸ**:
   - âœ… çŠ¶æ€ä¿æŒä¸å˜ï¼ˆå·²æäº¤ï¼Œåªè¯»ï¼‰
   - âœ… æ˜¾ç¤ºä¹‹å‰é€‰æ‹©çš„ç­”æ¡ˆ
   - âœ… æ˜¾ç¤ºæ­£ç¡®/é”™è¯¯çŠ¶æ€
   - âœ… æ˜¾ç¤ºé”™è¯¯æ¬¡æ•°ï¼ˆå¦‚æœé”™è¯¯ï¼‰

### æµ‹è¯•åœºæ™¯ 5: è·¨è®¾å¤‡

1. **æ“ä½œ**: 
   - è®¾å¤‡ A: ç™»å½•ï¼Œæäº¤ç­”æ¡ˆ
   - è®¾å¤‡ B: ä½¿ç”¨ç›¸åŒé‚®ç®±ç™»å½•ï¼Œè®¿é—® `/questions`
2. **é¢„æœŸ**:
   - âœ… çœ‹åˆ°ç›¸åŒçš„çŠ¶æ€
   - âœ… çœ‹åˆ°ç›¸åŒçš„ç­”æ¡ˆ
   - âœ… çœ‹åˆ°ç›¸åŒçš„æ­£ç¡®/é”™è¯¯çŠ¶æ€

### æµ‹è¯•åœºæ™¯ 6: é‡å¤ç­”é”™ï¼ˆé€šè¿‡ APIï¼‰

1. **æ“ä½œ**: é€šè¿‡ API ç›´æ¥æäº¤é”™è¯¯ç­”æ¡ˆå¤šæ¬¡
2. **é¢„æœŸ**:
   - âœ… wrong_count é€’å¢ï¼š1 â†’ 2 â†’ 3 ...
   - âœ… ä¸ä¼šå›æ»šæˆ–é‡ç½®

---

## ğŸ” ä»£ç éªŒè¯

### æ£€æŸ¥ç‚¹ 1: æ—  localStorage

```bash
grep -r "localStorage\|sessionStorage" app/questions
# åº”è¯¥è¿”å›ç©ºï¼ˆæ— åŒ¹é…ï¼‰
```

### æ£€æŸ¥ç‚¹ 2: çŠ¶æ€ä»åç«¯æ¢å¤

```typescript
// app/questions/page.tsx
useEffect(() => {
  loadQuestion() // âœ… æ¯æ¬¡åŠ è½½éƒ½ä»åç«¯è·å–
}, [])

async function loadQuestion() {
  const response = await fetch('/api/progress/resume', ...) // âœ… ä»åç«¯
  const data = await response.json()
  setProgress(data.progress) // âœ… ä»åç«¯æ¢å¤
  if (data.progress?.selected_answer) {
    setSelectedAnswers(data.progress.selected_answer) // âœ… ä»åç«¯æ¢å¤
  }
}
```

### æ£€æŸ¥ç‚¹ 3: åç«¯éªŒè¯ç­”æ¡ˆ

```typescript
// app/api/progress/route.ts
// åç«¯æ¯”è¾ƒ selected_answer å’Œ correct_answers
// è¿”å›å®é™…çŠ¶æ€ï¼Œä¸ä¾èµ–å‰ç«¯ä¼ å…¥çš„ is_correct
```

---

## âœ… éªŒæ”¶ç»“æœ

æ‰€æœ‰ 6 æ¡è¦æ±‚éƒ½å·²æ»¡è¶³ï¼š

1. âœ… é¦–æ¬¡è¿›å…¥ â†’ æ˜¾ç¤ºé¢˜ç›®ï¼Œå¯ä½œç­”
2. âœ… æäº¤ç­”æ¡ˆ â†’ æ˜¾ç¤º Correct / Incorrect
3. âœ… åˆ·æ–°é¡µé¢ â†’ çŠ¶æ€ä¸å˜
4. âœ… æ¢æµè§ˆå™¨ / è®¾å¤‡ â†’ çŠ¶æ€ä¸€è‡´
5. âœ… é‡å¤ç­”é”™ â†’ wrong_count ç´¯åŠ ï¼ˆåç«¯å®ç°ï¼‰
6. âœ… UI ä¸ä¾èµ– localStorage / useState æ¢å¤çŠ¶æ€

**Phase 3A éªŒæ”¶é€šè¿‡ âœ…**

---

## ğŸ“ æ³¨æ„äº‹é¡¹

### useState çš„ä½¿ç”¨

`useState` åœ¨ä»£ç ä¸­ç”¨äºï¼š
- `loading` - UI ä¸´æ—¶çŠ¶æ€ï¼ˆåŠ è½½ä¸­ï¼‰
- `submitting` - UI ä¸´æ—¶çŠ¶æ€ï¼ˆæäº¤ä¸­ï¼‰
- `error` - UI ä¸´æ—¶çŠ¶æ€ï¼ˆé”™è¯¯æ¶ˆæ¯ï¼‰
- `question` - ä»åç«¯è·å–çš„é—®é¢˜æ•°æ®ï¼ˆæ¯æ¬¡åŠ è½½éƒ½é‡æ–°è·å–ï¼‰
- `progress` - ä»åç«¯è·å–çš„è¿›åº¦æ•°æ®ï¼ˆæ¯æ¬¡åŠ è½½éƒ½é‡æ–°è·å–ï¼‰
- `selectedAnswers` - ä»åç«¯æ¢å¤çš„å·²é€‰ç­”æ¡ˆï¼ˆæ¯æ¬¡åŠ è½½éƒ½é‡æ–°è·å–ï¼‰

**å…³é”®**: è¿™äº›çŠ¶æ€åœ¨é¡µé¢åŠ è½½æ—¶éƒ½ä»åç«¯è·å–ï¼Œä¸ä¾èµ–æœ¬åœ°æŒä¹…åŒ–ã€‚

### çŠ¶æ€æ¢å¤æµç¨‹

```
é¡µé¢åŠ è½½
  â†“
useEffect è§¦å‘
  â†“
loadQuestion() è°ƒç”¨
  â†“
GET /api/progress/resume
  â†“
åç«¯ä»æ•°æ®åº“è¯»å–æœ€æ–°çŠ¶æ€
  â†“
è¿”å› question + progress
  â†“
å‰ç«¯è®¾ç½®çŠ¶æ€ï¼ˆä»åç«¯æ•°æ®ï¼‰
  â†“
UI æ¸²æŸ“ï¼ˆåŸºäºåç«¯çŠ¶æ€ï¼‰
```

**æ‰€æœ‰æŒä¹…åŒ–çŠ¶æ€éƒ½æ¥è‡ªåç«¯ï¼Œå‰ç«¯ä¸çŒœæµ‹ã€‚**

---

**éªŒæ”¶æµ‹è¯•å®Œæˆ âœ…**

